function iniciarJuego(){if(RECURSOS_LISTOS){Q.stageScene("nivel1",{sort:!0});var e=Q("Pacman").first(),i=Q("Fantasma").first();e.add("controlLocal"),i.add("aiEnemigo")}else setTimeout(iniciarJuego,500)}var Q=Quintus({development:!0,imagePath:"estatico/images/",audioPath:"estatico/audio/",dataPath:"estatico/data/"});Q.include("Sprites, Scenes, Input, 2D, Touch, Audio,Anim,UI"),Q.setup("juego"),Q.enableSound(),Q.controls(),Q.touch(),Q.gravityX=0,Q.gravityY=0;var PACMAN=1,MAPA=2,ENEMIGO=4,PUNTO=8,ALIMENTO=16,PODER=32,RECURSOS_LISTOS=!1;Q.load("mapa.tmx, mosaicos.png, pacman_titulo.png",function(){Q.sheet("mosaicos","mosaicos.png",{tileW:20,tileH:20}),RECURSOS_LISTOS=!0}),Q.animations("mosaicos_anim",{brillar:{frames:[27,28],rate:.5},pacman:{frames:[70,71],rate:1/3}}),Q.Sprite.extend("Punto",{init:function(e){this._super(e,{sheet:"mosaicos",sensor:!0,type:PUNTO}),this.on("sensor",function(){Q.state.inc("puntaje",1),this.destroy()})}}),Q.Sprite.extend("Alimento",{init:function(e){this._super(e,{sheet:"mosaicos",sensor:!0,type:ALIMENTO}),this.on("sensor",function(){this.destroy()})}}),Q.Sprite.extend("Poder",{init:function(e){this._super(e,{sheet:"mosaicos",sprite:"mosaicos_anim",type:PODER,sensor:!0}),this.on("sensor",function(){this.destroy()}),this.add("animation"),this.play("brillar")}}),Q.Sprite.extend("Fantasma",{init:function(e){this._super(e,{sheet:"mosaicos",type:ENEMIGO,z:10,collisionMask:PACMAN|MAPA}),this.add("2d")}}),Q.Sprite.extend("Pacman",{init:function(e){this._super(e,{sheet:"mosaicos",sprite:"mosaicos_anim",tileW:18,tileH:18,type:PACMAN,z:20,velocidad:100,collisionMask:ENEMIGO|ALIMENTO|PUNTO|PODER|MAPA}),this.add("2d, animation"),this.play("pacman"),this.on("hit",function(e){e.obj.isA("Fantasma")&&(Q.stage(0).pause(),Q.stageScene("perdiste",1,{sort:!0}))})}}),Q.TileLayer.extend("Mapa",{init:function(){this._super({dataAsset:"mapa.tmx",sheet:"mosaicos",tileW:20,tileH:20,type:MAPA})},configurar:function(){for(var e=this.p.tiles,i=0;i<e.length;i++)for(var a=e[i],t=0;t<a.length;t++){var n=a[t],o=20*t+10,s=20*i+10,r=null;switch(n){case 90:case 91:case 92:case 93:r="Alimento";break;case-1:r="Punto",n=29;break;case 70:r="Pacman";break;case 27:r="Poder";break;case 30:case 40:case 50:case 60:r="Fantasma"}if(null!=r){{this.stage.insert(new Q[r]({x:o,y:s,sheet:"mosaicos",frame:n}))}a[t]=-1}}}}),Q.UI.Text.extend("EtiquetaPuntos",{init:function(e){this._super(e,{label:"0",color:"white"}),Q.state.on("change.puntaje",this,"actualizaPuntaje")},actualizaPuntaje:function(e){this.p.label=""+e}}),Q.component("aiEnemigo",{added:function(){var e=this.entity.p;e.velocidad=100,e.direccion="izquierda",e.porcentajeCambio=.02,this.entity.on("step",this,"controles"),this.entity.on("hit",this,"cambiarEnAtasco")},controles:function(){var e=this.entity.p;switch(Math.random()<e.porcentajeCambio&&this.cambiarEnMovimiento(),e.direccion){case"izquierda":e.vx=-e.velocidad;break;case"derecha":e.vx=e.velocidad;break;case"arriba":e.vy=-e.velocidad;break;case"abajo":e.vy=e.velocidad}},cambiarEnMovimiento:function(){var e=this.entity.p;0!=e.vy&&0==e.vx?e.direccion=Math.random()<.5?"izquierda":"derecha":0!=e.vx&&0==e.vy&&(e.direccion=Math.random()<.5?"arriba":"abajo")},cambiarEnAtasco:function(e){var i=this.entity.p;0==i.vx&&0==i.vy&&(e.normalY?i.direccion=Math.random()<.5?"izquierda":"derecha":e.normalX&&(i.direccion=Math.random()<.5?"arriba":"abajo"))}}),Q.component("controlLocal",{added:function(){var e=this.entity.p;e.direccion="izquierda",Q._defaults(e,{velocidad:100}),this.entity.on("step",this,"controles")},controles:function(){var e=this.entity.p;switch(e.direccion=Q.inputs.left?"izquierda":Q.inputs.right?"derecha":Q.inputs.up?"arriba":Q.inputs.down?"abajo":e.direccion,e.direccion){case"izquierda":e.vx=-e.velocidad;break;case"derecha":e.vx=e.velocidad;break;case"arriba":e.vy=-e.velocidad;break;case"abajo":e.vy=e.velocidad}}}),Q.scene("nivel1",function(e){var i=e.collisionLayer(new Q.Mapa);i.configurar(),Q.state.set("puntaje",0),e.insert(new Q.UI.Text({label:"Puntaje",x:500,y:30,size:20,color:"red",family:"Fascinate Inline"})),e.insert(new Q.EtiquetaPuntos({x:500,y:70,size:20}))}),Q.scene("perdiste",function(e){var i=e.insert(new Q.UI.Container({x:Q.width/2,y:Q.height/2,fill:"rgba(255, 255, 255, 0.7)"})),a=i.insert(new Q.UI.Button({x:0,y:0,shadow:!0,shadowColor:"red",fill:"red",fill:"#CCCCCC",fontColor:"white",label:"Volver a Jugar"}));i.insert(new Q.UI.Text({x:0,y:-70,size:60,color:"#FFEE00",label:"Game Over",family:"Fascinate Inline"})),i.fit(30),a.on("click",function(){Q.clearStages(),iniciarJuego()})}),Q.scene("intro",function(e){e.insert(new Q.Sprite({x:300,y:100,asset:"pacman_titulo.png"}));var i=e.insert(new Q.UI.Button({x:300,y:200,fill:"#F9A11C",size:40,fontColor:"white",label:"Comenzar a Jugar"}));i.on("click",function(){Q.clearStages(),Q.stageScene("nivel1",{sort:!0})})}),iniciarJuego();